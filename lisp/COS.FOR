      SUBROUTINE PUTCH(VEC,CH,I)
      INTEGER VEC(*),BI,CH,SHFT,MSK,WI,WORD

      WI   = SHIFTR(I - 1, 3) + 1
      BI   = (I - 1).AND.7
      WORD = VEC(WI)
      MSK  = MASK(8)
      SHFT = SHIFTL(BI,3)
      VEC(WI) = (WORD.AND.(.NOT.SHIFTR(MSK,SHFT)))
     &          .OR.SHIFTR(CH.AND.MSK,SHFT)
      END
      SUBROUTINE GETCH(VEC,CH,I)
      INTEGER VEC(*),BI,CH,WI

      WI = SHIFTR(I - 1, 3) + 1
      BI = (I - 1).AND.7
      CH = (SHIFTL(VEC(WI),SHIFTL(BI, 3)).AND.MASK(8))
     &     .OR.401002004010020040B
      END
      FUNCTION OPENF(X)
C-- OPENS AN OS-FILE. RETURNS LOGICAL UNIT.
C-- IF OPENF LE 0 THEN ERROR
C-- X IS A LIST (FILENAME INPUT . BINARY)
C-- IF INPUT NE NIL   INPUT FILE (ELSE OUTPUT)
C-- IF BINARY NE NIL  BINARY FILE (ELSE ASCII)
      INCLUDE 'F4COM.FOR'
      COMMON /FILTAB/ LUNTAB(10)
      INTEGER OPENF,X
      CHARACTER*3 ACC
      CHARACTER*11 MODE
      CHARACTER*7 FNAME
      EQUIVALENCE (FNAME,ABUFF(1))
C-- IF NLISTP(X) THEN GOTO 3
      IF(X.LE.NATOM.OR.X.GT.NFREET)GO TO 3
      IFILE=CAR(X)
      X=CDR(X)
      IF(X.LE.NATOM.OR.X.GT.NFREET)GO TO 3
      INPUT=CAR(X)
      IBIN=CDR(X)
      IF(MPNAME(IFILE,ABUFF(1),7,IPL).NE.0)GO TO 3
1     DO 2 I=1,10
      IF(LUNTAB(I).EQ.0)GO TO 4
2     CONTINUE
      WRITE(103,*) 'LUN table full. Failed to open ',FNAME
3     OPENF = -1
      RETURN
4     LUNTAB(I)=1
C-- WE USE LOGICAL UNIT 10-19
      ACC='OLD'
      IF(INPUT.EQ.NIL) ACC='NEW'
      MODE='FORMATTED'
      IF(IBIN.NE.NIL)MODE='UNFORMATTED'
      OPEN(FILE=FNAME,FORM=MODE,STATUS=ACC,ERR=5,IOSTAT=IOS,UNIT=9+I)
      OPENF=9+I
      RETURN
5     WRITE(103,*) 'Error ',IOS,'. Failed to open ',FNAME
      END
      SUBROUTINE REW(LUN)
      COMMON /FILTAB/ LUNTAB(10)
      CLOSE(UNIT=LUN,ERR=999,IOSTAT=IOS)
      IF( LUN.GE.10 .AND. LUN.LT.20 ) LUNTAB(LUN-9)=0
      RETURN
999   WRITE(103,*) 'Error ',IOS,'. REW failed to close unit ',LUN
      END
      SUBROUTINE EJECT(LUN)
      WRITE(LUN,*) '1'
      END
      FUNCTION MSLFT(I)
      MSLFT=0
      END
      SUBROUTINE MTIME(IT)
      IT = CLOCK()
      END
      SUBROUTINE MDATE(IT)
C SHOULD RETURN 10 CHARACTERS
      IT = DATE()
      END
      SUBROUTINE BRSET
      RETURN
      END
      SUBROUTINE UPCASE(BUFF,L)
      INTEGER BUFF(*),L
C                           UPPERCASE THE CHARACTERS IN ABUFF
C                           NUMBER OF CHARACTERS = L
C                           FORMAT IS A1 FORMAT
      DO I = 1,L
        IC = BUFF(I)
        IF (IC.GE.97.AND.IC.LE.122) THEN
          BUFF(I) = IC - 32
        END IF
      END DO
      END
